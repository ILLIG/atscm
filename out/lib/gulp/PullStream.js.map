{"version":3,"file":"PullStream.js","names":["_readline","_interopRequireDefault","require","_gulplog","_ProjectConfig","_Transformer","_interopRequireWildcard","_dest","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","PullStream","constructor","readStream","printProgress","setInterval","Logger","info","processed","opsPerSecond","toFixed","listenerCount","readline","cursorTo","process","stdout","moveCursor","Transformer","applyTransformers","ProjectConfig","useTransformers","TransformDirection","FromDB","pipe","dest","on","clearLine","clearInterval","exports"],"sources":["../../../src/lib/gulp/PullStream.js"],"sourcesContent":["import readline from 'readline';\r\nimport Logger from 'gulplog';\r\nimport ProjectConfig from '../../config/ProjectConfig';\r\nimport Transformer, { TransformDirection } from '../transform/Transformer';\r\nimport dest from './dest';\r\n\r\n/**\r\n * A stream that transforms read {@link ReadStream.ReadResult}s and stores the on the filesystem.\r\n */\r\nexport default class PullStream {\r\n  /**\r\n   * Creates a new PullStream based on a stream that writes {@link ReadStream.ReadResult} which may\r\n   * be an instance of {@link ReadStream}.\r\n   * @param {ReadStream} readStream The stream to read from.\r\n   */\r\n  constructor(readStream) {\r\n    const printProgress = setInterval(() => {\r\n      Logger.info(`Pulled: ${readStream.processed} (${readStream.opsPerSecond.toFixed(1)} ops/s)`);\r\n\r\n      if (Logger.listenerCount('info') > 0) {\r\n        readline.cursorTo(process.stdout, 0);\r\n        readline.moveCursor(process.stdout, 0, -1);\r\n      }\r\n    }, 1000);\r\n\r\n    return Transformer.applyTransformers(\r\n      readStream,\r\n      ProjectConfig.useTransformers,\r\n      TransformDirection.FromDB\r\n    )\r\n      .pipe(dest('./src')) // FIXME: Get from config file\r\n      .on('finish', () => {\r\n        if (Logger.listenerCount('info') > 0) {\r\n          readline.clearLine(process.stdout, 0);\r\n          readline.cursorTo(process.stdout, 0);\r\n        }\r\n\r\n        clearInterval(printProgress);\r\n      });\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}