{"version":3,"file":"PushStream.js","names":["_readline","_interopRequireDefault","require","_gulplog","_ProjectConfig","_Transformer","_interopRequireWildcard","_WriteStream","_CreateNodeStream","_AddReferencesStream","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","PushStream","constructor","srcStream","createStream","CreateNodeStream","addReferencesStream","AddReferencesStream","writeStream","WriteStream","printProgress","setInterval","Logger","info","_processed","opsPerSecond","toFixed","listenerCount","readline","cursorTo","process","stdout","moveCursor","Transformer","applyTransformers","ProjectConfig","useTransformers","TransformDirection","FromFilesystem","pipe","on","clearLine","clearInterval","exports"],"sources":["../../../src/lib/gulp/PushStream.js"],"sourcesContent":["import readline from 'readline';\r\nimport Logger from 'gulplog';\r\nimport ProjectConfig from '../../config/ProjectConfig';\r\nimport Transformer, { TransformDirection } from '../transform/Transformer';\r\nimport WriteStream from '../server/WriteStream';\r\nimport CreateNodeStream from '../server/CreateNodeStream';\r\nimport AddReferencesStream from '../server/AddReferencesStream';\r\n\r\n/**\r\n * A stream that transforms read {@link vinyl~File}s and pushes them to atvise server.\r\n */\r\nexport default class PushStream {\r\n  /**\r\n   * Creates a new PushSteam based on a source file stream.\r\n   * @param {Stream} srcStream The file stream to read from.\r\n   */\r\n  constructor(srcStream) {\r\n    const createStream = new CreateNodeStream();\r\n    const addReferencesStream = new AddReferencesStream();\r\n    const writeStream = new WriteStream(createStream, addReferencesStream);\r\n\r\n    const printProgress = setInterval(() => {\r\n      Logger.info(\r\n        `Pushed: ${writeStream._processed} (${writeStream.opsPerSecond.toFixed(1)} ops/s)`\r\n      );\r\n\r\n      if (Logger.listenerCount('info') > 0) {\r\n        readline.cursorTo(process.stdout, 0);\r\n        readline.moveCursor(process.stdout, 0, -1);\r\n      }\r\n    }, 1000);\r\n\r\n    return Transformer.applyTransformers(\r\n      srcStream,\r\n      ProjectConfig.useTransformers,\r\n      TransformDirection.FromFilesystem\r\n    )\r\n      .pipe(writeStream)\r\n      .pipe(createStream)\r\n      .pipe(addReferencesStream)\r\n      .on('finish', () => {\r\n        if (Logger.listenerCount('info') > 0) {\r\n          readline.cursorTo(process.stdout, 0);\r\n          readline.clearLine(process.stdout);\r\n        }\r\n\r\n        clearInterval(printProgress);\r\n      });\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}