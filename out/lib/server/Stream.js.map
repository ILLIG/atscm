{"version":3,"file":"Stream.js","names":["_through","require","_Session","_interopRequireDefault","e","__esModule","default","Stream","throughStreamClass","objectMode","constructor","options","_keepSessionAlive","keepSessionAlive","Session","create","then","session","emit","catch","err","_flush","callback","close","exports"],"sources":["../../../src/lib/server/Stream.js"],"sourcesContent":["import { ctor as throughStreamClass } from 'through2';\r\nimport Session from './Session';\r\n\r\n/**\r\n * An object transform stream connected to atvise server.\r\n */\r\nexport default class Stream extends throughStreamClass({ objectMode: true }) {\r\n  /**\r\n   * Creates a new Stream and starts opening a new session to atvise server.\r\n   * @param {Object} [options] The options to use. See the through2 documentation for details.\r\n   * @param {boolean} [options.keepSessionAlive=false] If the ativse server session should be closed\r\n   * one the stream ends.\r\n   * @emits {Session} Emits an `session-open` event once the session is open, passing the Session\r\n   * instance.\r\n   * @see https://github.Com/rvagg/through2#options\r\n   */\r\n  constructor(options = {}) {\r\n    super(options);\r\n\r\n    /**\r\n     * `true` if the stream's atvise server session should be kept alive once the stream ends.\r\n     * @type {Boolean}\r\n     */\r\n    this._keepSessionAlive = options.keepSessionAlive || false;\r\n\r\n    Session.create()\r\n      .then((session) => (this.session = session))\r\n      .then((session) => this.emit('session-open', session))\r\n      .catch((err) => this.emit('error', err));\r\n  }\r\n\r\n  /**\r\n   * Called just before the stream is closed: Closes the open session.\r\n   * @param {function(err: ?Error, data: Object)} callback Called once the session is closed.\r\n   */\r\n  _flush(callback) {\r\n    if (this.session && !this._keepSessionAlive) {\r\n      Session.close(this.session)\r\n        .then(() => callback())\r\n        .catch((err) => callback(err));\r\n    } else {\r\n      callback();\r\n    }\r\n  }\r\n}\r\n"],"mappings":";;;;;;AAAA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,QAAA,GAAAC,sBAAA,CAAAF,OAAA;AAAgC,SAAAE,uBAAAC,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAEhC;AACA;AACA;AACe,MAAMG,MAAM,SAAS,IAAAC,aAAkB,EAAC;EAAEC,UAAU,EAAE;AAAK,CAAC,CAAC,CAAC;EAC3E;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,WAAWA,CAACC,OAAO,GAAG,CAAC,CAAC,EAAE;IACxB,KAAK,CAACA,OAAO,CAAC;;IAEd;AACJ;AACA;AACA;IACI,IAAI,CAACC,iBAAiB,GAAGD,OAAO,CAACE,gBAAgB,IAAI,KAAK;IAE1DC,gBAAO,CAACC,MAAM,CAAC,CAAC,CACbC,IAAI,CAAEC,OAAO,IAAM,IAAI,CAACA,OAAO,GAAGA,OAAQ,CAAC,CAC3CD,IAAI,CAAEC,OAAO,IAAK,IAAI,CAACC,IAAI,CAAC,cAAc,EAAED,OAAO,CAAC,CAAC,CACrDE,KAAK,CAAEC,GAAG,IAAK,IAAI,CAACF,IAAI,CAAC,OAAO,EAAEE,GAAG,CAAC,CAAC;EAC5C;;EAEA;AACF;AACA;AACA;EACEC,MAAMA,CAACC,QAAQ,EAAE;IACf,IAAI,IAAI,CAACL,OAAO,IAAI,CAAC,IAAI,CAACL,iBAAiB,EAAE;MAC3CE,gBAAO,CAACS,KAAK,CAAC,IAAI,CAACN,OAAO,CAAC,CACxBD,IAAI,CAAC,MAAMM,QAAQ,CAAC,CAAC,CAAC,CACtBH,KAAK,CAAEC,GAAG,IAAKE,QAAQ,CAACF,GAAG,CAAC,CAAC;IAClC,CAAC,MAAM;MACLE,QAAQ,CAAC,CAAC;IACZ;EACF;AACF;AAACE,OAAA,CAAAlB,OAAA,GAAAC,MAAA","ignoreList":[]}