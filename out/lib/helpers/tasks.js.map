{"version":3,"file":"tasks.js","names":["_codeFrame","require","_Session","_interopRequireDefault","e","__esModule","default","handleTaskError","error","location","rawLines","originalStack","stack","message","codeFrameColumns","additionalMessage","node","nodeId","Object","assign","finishTask","Session","closeOpen"],"sources":["../../../src/lib/helpers/tasks.js"],"sourcesContent":["import { codeFrameColumns } from '@babel/code-frame';\r\nimport Session from '../server/Session';\r\n\r\n/**\r\n * Adds additional infomation to the error's message and rethows it.\r\n * @param {Error} error The error that occured.\r\n * @throws {Error} The extended error.\r\n */\r\nexport function handleTaskError(error) {\r\n  if (error.location && error.rawLines) {\r\n    error.originalStack = error.stack; // eslint-disable-line no-param-reassign\r\n    // eslint-disable-next-line no-param-reassign\r\n    error.stack = `${error.message}\r\n${codeFrameColumns(error.rawLines, error.location, { message: error.message })}`;\r\n  }\r\n\r\n  const additionalMessage = error.node\r\n    ? `\r\n - Node: ${error.node.nodeId}`\r\n    : '';\r\n\r\n  Object.assign(error, {\r\n    message: `${error.message}${additionalMessage}`,\r\n    stack: `${error.stack}${additionalMessage}`,\r\n  });\r\n\r\n  throw error;\r\n}\r\n\r\n/**\r\n * Closes open sessions once a task is complete.\r\n * @return {Promise<void>} Resolved once cleanup is complete.\r\n */\r\nexport function finishTask() {\r\n  return Session.closeOpen();\r\n}\r\n"],"mappings":";;;;;;;AAAA,IAAAA,UAAA,GAAAC,OAAA;AACA,IAAAC,QAAA,GAAAC,sBAAA,CAAAF,OAAA;AAAwC,SAAAE,uBAAAC,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAExC;AACA;AACA;AACA;AACA;AACO,SAASG,eAAeA,CAACC,KAAK,EAAE;EACrC,IAAIA,KAAK,CAACC,QAAQ,IAAID,KAAK,CAACE,QAAQ,EAAE;IACpCF,KAAK,CAACG,aAAa,GAAGH,KAAK,CAACI,KAAK,CAAC,CAAC;IACnC;IACAJ,KAAK,CAACI,KAAK,GAAG,GAAGJ,KAAK,CAACK,OAAO;AAClC,EAAE,IAAAC,2BAAgB,EAACN,KAAK,CAACE,QAAQ,EAAEF,KAAK,CAACC,QAAQ,EAAE;MAAEI,OAAO,EAAEL,KAAK,CAACK;IAAQ,CAAC,CAAC,EAAE;EAC9E;EAEA,MAAME,iBAAiB,GAAGP,KAAK,CAACQ,IAAI,GAChC;AACN,WAAWR,KAAK,CAACQ,IAAI,CAACC,MAAM,EAAE,GACxB,EAAE;EAENC,MAAM,CAACC,MAAM,CAACX,KAAK,EAAE;IACnBK,OAAO,EAAE,GAAGL,KAAK,CAACK,OAAO,GAAGE,iBAAiB,EAAE;IAC/CH,KAAK,EAAE,GAAGJ,KAAK,CAACI,KAAK,GAAGG,iBAAiB;EAC3C,CAAC,CAAC;EAEF,MAAMP,KAAK;AACb;;AAEA;AACA;AACA;AACA;AACO,SAASY,UAAUA,CAAA,EAAG;EAC3B,OAAOC,gBAAO,CAACC,SAAS,CAAC,CAAC;AAC5B","ignoreList":[]}