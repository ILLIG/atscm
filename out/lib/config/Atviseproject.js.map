{"version":3,"file":"Atviseproject.js","names":["_NodeId","_interopRequireDefault","require","_DisplayTransformer","_ScriptTransformer","_Mapping","_AlarmConfigTransformer","e","__esModule","default","Atviseproject","host","port","opc","http","login","xmlTransformerOptions","sortXMLAttributes","removeBuilderRefs","useTransformers","AlarmConfigTransformer","DisplayTransformer","ServerscriptTransformer","QuickDynamicTransformer","DisplayScriptTransformer","MappingTransformer","nodes","NodeId","nodesToWatch","EditorRelatedNodes","ServerRelatedNodes","AtscmRelatedNodes","ignoreNodes","inspect","vcs","preserveSortOrderNodes","timeout","exports"],"sources":["../../../src/lib/config/Atviseproject.ts"],"sourcesContent":["/* eslint-disable no-useless-escape */\r\n\r\nimport NodeId from '../model/opcua/NodeId';\r\nimport DisplayTransformer from '../../transform/DisplayTransformer';\r\nimport {\r\n  ServerscriptTransformer,\r\n  QuickDynamicTransformer,\r\n  DisplayScriptTransformer,\r\n} from '../../transform/ScriptTransformer';\r\nimport MappingTransformer from '../../transform/Mapping';\r\nimport AlarmConfigTransformer from '../../transform/AlarmConfigTransformer';\r\nimport { Transformer } from '../..';\r\n\r\ninterface AtserverPortConfiguration {\r\n  /** The OPC-UA port the atvise-server runs on. */\r\n  opc: number;\r\n  /** The HTTP port the atvise-server can be reached at. */\r\n  http: number;\r\n}\r\n\r\ninterface AtserverCredentials {\r\n  /** The username to log in with. */\r\n  username: string;\r\n  /** The password to log in with. */\r\n  password: string;\r\n}\r\n\r\ntype NodesConfiguration = Array<string | NodeId>;\r\n\r\n/**\r\n * An *atscm* project's configuration.\r\n * @abstract\r\n */\r\nexport default class Atviseproject {\r\n  /**\r\n   * The atvise-server's host. Defaults to *localhost*.\r\n   */\r\n  static get host(): string {\r\n    return 'localhost';\r\n  }\r\n\r\n  /**\r\n   * The atvise-server ports to use.\r\n   */\r\n  static get port(): AtserverPortConfiguration {\r\n    return {\r\n      opc: 4840,\r\n      http: 80,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * The login to use. Return `false` if no login is required (default).\r\n   */\r\n  static get login(): false | AtserverCredentials {\r\n    return false;\r\n  }\r\n\r\n  private static get xmlTransformerOptions() {\r\n    return {\r\n      sortXMLAttributes: this.sortXMLAttributes,\r\n      removeBuilderRefs: this.removeBuilderRefs,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * The transformers to use in this project. Returns a {@link DisplayTransformer}, a\r\n   * {@link ScriptTransformer} and a {@link NewlinesTransformer} by default.\r\n   */\r\n  static get useTransformers(): Transformer[] {\r\n    return [\r\n      new AlarmConfigTransformer(),\r\n      new DisplayTransformer(this.xmlTransformerOptions),\r\n      new ServerscriptTransformer(this.xmlTransformerOptions),\r\n      new QuickDynamicTransformer(this.xmlTransformerOptions),\r\n      new DisplayScriptTransformer(this.xmlTransformerOptions),\r\n      new MappingTransformer() as any,\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * The atvise-server nodes that atscm should sync. Defaults to the nodes *AGENT*, *SYSTEM*,\r\n   * *ObjectTypes.PROJECT* and *VariableTypes.PROJECT*.\r\n   */\r\n  static get nodes(): NodesConfiguration {\r\n    return [\r\n      new NodeId('AGENT'),\r\n      new NodeId('SYSTEM'),\r\n      new NodeId('ObjectTypes.PROJECT'),\r\n      new NodeId('VariableTypes.PROJECT'),\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * The atvise-server nodes to watch in the corresponding tasks. Defaults to all nodes containing\r\n   * displays.\r\n   */\r\n  static get nodesToWatch(): NodesConfiguration {\r\n    return [new NodeId('AGENT.DISPLAYS'), new NodeId('SYSTEM.LIBRARY.PROJECT.OBJECTDISPLAYS')];\r\n  }\r\n\r\n  /**\r\n   * An array of editor related node ids. They should be ignored in a atscm project.\r\n   */\r\n  static get EditorRelatedNodes(): NodesConfiguration {\r\n    return [new NodeId('SYSTEM.JOURNALS.ProjectHistory')];\r\n  }\r\n\r\n  /**\r\n   * An array of server related node ids. They should be ignored in a atscm project\r\n   * as they are read-only.\r\n   */\r\n  static get ServerRelatedNodes(): NodesConfiguration {\r\n    return [\r\n      new NodeId('AGENT.OPCUA.server_url'),\r\n      new NodeId('AGENT.WEBACCESS.https?[^.]+.(state)'),\r\n      new NodeId('SYSTEM.INFORMATION.LOGS.'),\r\n      new NodeId('AGENT.GENERATOR.METHODS'),\r\n      new NodeId('AGENT.MIRROR.METHODS'),\r\n      new NodeId('AGENT.HISTORY.METHODS'),\r\n      new NodeId('AGENT.SCRIPT.METHODS'),\r\n      new NodeId('AGENT.OPCUA.METHODS'),\r\n      new NodeId('AGENT.ALARMING.METHODS'),\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Server nodes atscm manages itself. These include the serverscripts used during pull/push for\r\n   * example.\r\n   */\r\n  static get AtscmRelatedNodes(): NodesConfiguration {\r\n    return [new NodeId('SYSTEM.LIBRARY.ATVISE.SERVERSCRIPTS.atscm')];\r\n  }\r\n\r\n  /**\r\n   * These nodes (and their subnodes, if any) will be ignored by atscm. Defaults to\r\n   * {@link Atviseproject.EditorRelatedNodes} combined with\r\n   * {@link Atviseproject.ServerRelatedNodes}.\r\n   */\r\n  static get ignoreNodes(): NodesConfiguration {\r\n    return [...this.EditorRelatedNodes, ...this.ServerRelatedNodes, ...this.AtscmRelatedNodes];\r\n  }\r\n\r\n  /**\r\n   * Returns an object containing the properties to inspect.\r\n   * @see https://nodejs.org/api/util.html#util_util_inspect_object_options\r\n   */\r\n  static inspect() {\r\n    return {\r\n      host: this.host,\r\n      port: this.port,\r\n      login: this.login,\r\n      useTransformers: this.useTransformers,\r\n      nodes: this.nodes,\r\n      nodesToWatch: this.nodesToWatch,\r\n      ignoreNodes: this.ignoreNodes,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * The *version control system* to optimize tasks for.\r\n   * @since 1.0.0\r\n   */\r\n  static get vcs(): 'git' | 'svn' {\r\n    return 'git';\r\n  }\r\n\r\n  /**\r\n   * If atvise builder sort order nodes should be stored.\r\n   * @since 1.0.0\r\n   * @deprecated Mapping source order nodes leads to inconsistent results in many cases.\r\n   */\r\n  static get preserveSortOrderNodes(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * The connection timeout, in milliseconds.\r\n   */\r\n  static get timeout(): number {\r\n    return 10000;\r\n  }\r\n\r\n  /**\r\n   * Remove `atv:refpx` and `atv:refpy` attributes from XML to minimize diffs between pulls. This\r\n   * will eventually default to *true* in a future atscm version.\r\n   */\r\n  static get removeBuilderRefs(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Sort XML attributes to minimize diffs between pulls. This will eventually default to *true* in\r\n   * a future atscm version.\r\n   */\r\n  static get sortXMLAttributes(): boolean {\r\n    return false;\r\n  }\r\n}\r\n"],"mappings":";;;;;;AAEA,IAAAA,OAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,mBAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,kBAAA,GAAAF,OAAA;AAKA,IAAAG,QAAA,GAAAJ,sBAAA,CAAAC,OAAA;AACA,IAAAI,uBAAA,GAAAL,sBAAA,CAAAC,OAAA;AAA4E,SAAAD,uBAAAM,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAV5E;;AA6BA;AACA;AACA;AACA;AACe,MAAMG,aAAa,CAAC;EACjC;AACF;AACA;EACE,WAAWC,IAAIA,CAAA,EAAW;IACxB,OAAO,WAAW;EACpB;;EAEA;AACF;AACA;EACE,WAAWC,IAAIA,CAAA,EAA8B;IAC3C,OAAO;MACLC,GAAG,EAAE,IAAI;MACTC,IAAI,EAAE;IACR,CAAC;EACH;;EAEA;AACF;AACA;EACE,WAAWC,KAAKA,CAAA,EAAgC;IAC9C,OAAO,KAAK;EACd;EAEA,WAAmBC,qBAAqBA,CAAA,EAAG;IACzC,OAAO;MACLC,iBAAiB,EAAE,IAAI,CAACA,iBAAiB;MACzCC,iBAAiB,EAAE,IAAI,CAACA;IAC1B,CAAC;EACH;;EAEA;AACF;AACA;AACA;EACE,WAAWC,eAAeA,CAAA,EAAkB;IAC1C,OAAO,CACL,IAAIC,+BAAsB,CAAC,CAAC,EAC5B,IAAIC,2BAAkB,CAAC,IAAI,CAACL,qBAAqB,CAAC,EAClD,IAAIM,0CAAuB,CAAC,IAAI,CAACN,qBAAqB,CAAC,EACvD,IAAIO,0CAAuB,CAAC,IAAI,CAACP,qBAAqB,CAAC,EACvD,IAAIQ,2CAAwB,CAAC,IAAI,CAACR,qBAAqB,CAAC,EACxD,IAAIS,gBAAkB,CAAC,CAAC,CACzB;EACH;;EAEA;AACF;AACA;AACA;EACE,WAAWC,KAAKA,CAAA,EAAuB;IACrC,OAAO,CACL,IAAIC,eAAM,CAAC,OAAO,CAAC,EACnB,IAAIA,eAAM,CAAC,QAAQ,CAAC,EACpB,IAAIA,eAAM,CAAC,qBAAqB,CAAC,EACjC,IAAIA,eAAM,CAAC,uBAAuB,CAAC,CACpC;EACH;;EAEA;AACF;AACA;AACA;EACE,WAAWC,YAAYA,CAAA,EAAuB;IAC5C,OAAO,CAAC,IAAID,eAAM,CAAC,gBAAgB,CAAC,EAAE,IAAIA,eAAM,CAAC,uCAAuC,CAAC,CAAC;EAC5F;;EAEA;AACF;AACA;EACE,WAAWE,kBAAkBA,CAAA,EAAuB;IAClD,OAAO,CAAC,IAAIF,eAAM,CAAC,gCAAgC,CAAC,CAAC;EACvD;;EAEA;AACF;AACA;AACA;EACE,WAAWG,kBAAkBA,CAAA,EAAuB;IAClD,OAAO,CACL,IAAIH,eAAM,CAAC,wBAAwB,CAAC,EACpC,IAAIA,eAAM,CAAC,qCAAqC,CAAC,EACjD,IAAIA,eAAM,CAAC,0BAA0B,CAAC,EACtC,IAAIA,eAAM,CAAC,yBAAyB,CAAC,EACrC,IAAIA,eAAM,CAAC,sBAAsB,CAAC,EAClC,IAAIA,eAAM,CAAC,uBAAuB,CAAC,EACnC,IAAIA,eAAM,CAAC,sBAAsB,CAAC,EAClC,IAAIA,eAAM,CAAC,qBAAqB,CAAC,EACjC,IAAIA,eAAM,CAAC,wBAAwB,CAAC,CACrC;EACH;;EAEA;AACF;AACA;AACA;EACE,WAAWI,iBAAiBA,CAAA,EAAuB;IACjD,OAAO,CAAC,IAAIJ,eAAM,CAAC,2CAA2C,CAAC,CAAC;EAClE;;EAEA;AACF;AACA;AACA;AACA;EACE,WAAWK,WAAWA,CAAA,EAAuB;IAC3C,OAAO,CAAC,GAAG,IAAI,CAACH,kBAAkB,EAAE,GAAG,IAAI,CAACC,kBAAkB,EAAE,GAAG,IAAI,CAACC,iBAAiB,CAAC;EAC5F;;EAEA;AACF;AACA;AACA;EACE,OAAOE,OAAOA,CAAA,EAAG;IACf,OAAO;MACLtB,IAAI,EAAE,IAAI,CAACA,IAAI;MACfC,IAAI,EAAE,IAAI,CAACA,IAAI;MACfG,KAAK,EAAE,IAAI,CAACA,KAAK;MACjBI,eAAe,EAAE,IAAI,CAACA,eAAe;MACrCO,KAAK,EAAE,IAAI,CAACA,KAAK;MACjBE,YAAY,EAAE,IAAI,CAACA,YAAY;MAC/BI,WAAW,EAAE,IAAI,CAACA;IACpB,CAAC;EACH;;EAEA;AACF;AACA;AACA;EACE,WAAWE,GAAGA,CAAA,EAAkB;IAC9B,OAAO,KAAK;EACd;;EAEA;AACF;AACA;AACA;AACA;EACE,WAAWC,sBAAsBA,CAAA,EAAY;IAC3C,OAAO,KAAK;EACd;;EAEA;AACF;AACA;EACE,WAAWC,OAAOA,CAAA,EAAW;IAC3B,OAAO,KAAK;EACd;;EAEA;AACF;AACA;AACA;EACE,WAAWlB,iBAAiBA,CAAA,EAAY;IACtC,OAAO,KAAK;EACd;;EAEA;AACF;AACA;AACA;EACE,WAAWD,iBAAiBA,CAAA,EAAY;IACtC,OAAO,KAAK;EACd;AACF;AAACoB,OAAA,CAAA5B,OAAA,GAAAC,aAAA","ignoreList":[]}