{"version":3,"file":"check-serverscripts.js","names":["_semver","require","_api","_version","_package","checkServerscripts","log","debug","required","dependencies","version","readNode","versionNode","value","release","split","valid","validVersion","Error","error","Object","assign","originalError"],"sources":["../../src/hooks/check-serverscripts.ts"],"sourcesContent":["import { satisfies as validVersion } from 'semver';\r\nimport { readNode } from '../api';\r\nimport { versionNode } from '../lib/server/scripts/version';\r\nimport { dependencies } from '../../package.json';\r\nimport { HookContext } from './hooks';\r\n\r\nexport default async function checkServerscripts({ log }: HookContext): Promise<void> {\r\n  log.debug('Checking installed serverscripts');\r\n\r\n  const required = dependencies['@atscm/server-scripts'];\r\n  let version;\r\n\r\n  try {\r\n    version = (await readNode(versionNode)).value;\r\n\r\n    const [release] = version.split('-beta');\r\n    const valid = validVersion(release, required);\r\n\r\n    if (!valid) throw new Error('Invalid version');\r\n\r\n    log.debug(`Serverscripts ${version} installed (${required} required)`);\r\n  } catch (error) {\r\n    throw Object.assign(\r\n      new Error(`Invalid server script version: ${version || 'not installed'} (${required} required)\r\n- Please run 'atscm import' again to update`),\r\n      { originalError: error }\r\n    );\r\n  }\r\n}\r\n"],"mappings":";;;;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,IAAA,GAAAD,OAAA;AACA,IAAAE,QAAA,GAAAF,OAAA;AACA,IAAAG,QAAA,GAAAH,OAAA;AAGe,eAAeI,kBAAkBA,CAAC;EAAEC;AAAiB,CAAC,EAAiB;EACpFA,GAAG,CAACC,KAAK,CAAC,kCAAkC,CAAC;EAE7C,MAAMC,QAAQ,GAAGC,qBAAY,CAAC,uBAAuB,CAAC;EACtD,IAAIC,OAAO;EAEX,IAAI;IACFA,OAAO,GAAG,CAAC,MAAM,IAAAC,aAAQ,EAACC,oBAAW,CAAC,EAAEC,KAAK;IAE7C,MAAM,CAACC,OAAO,CAAC,GAAGJ,OAAO,CAACK,KAAK,CAAC,OAAO,CAAC;IACxC,MAAMC,KAAK,GAAG,IAAAC,iBAAY,EAACH,OAAO,EAAEN,QAAQ,CAAC;IAE7C,IAAI,CAACQ,KAAK,EAAE,MAAM,IAAIE,KAAK,CAAC,iBAAiB,CAAC;IAE9CZ,GAAG,CAACC,KAAK,CAAC,iBAAiBG,OAAO,eAAeF,QAAQ,YAAY,CAAC;EACxE,CAAC,CAAC,OAAOW,KAAK,EAAE;IACd,MAAMC,MAAM,CAACC,MAAM,CACjB,IAAIH,KAAK,CAAC,kCAAkCR,OAAO,IAAI,eAAe,KAAKF,QAAQ;AACzF,4CAA4C,CAAC,EACvC;MAAEc,aAAa,EAAEH;IAAM,CACzB,CAAC;EACH;AACF","ignoreList":[]}