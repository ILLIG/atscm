{"version":3,"file":"cleanup.js","names":["_readline","_interopRequireDefault","require","_gulplog","_Session","e","__esModule","default","cleanup","exitCode","signal","uninstall","readline","clearLine","process","stdout","cursorTo","Logger","warn","debug","Session","open","length","removeAllListeners","on","closeOpen","then","kill","pid","catch","error","message"],"sources":["../../src/util/cleanup.js"],"sourcesContent":["import readline from 'readline';\r\nimport Logger from 'gulplog';\r\nimport Session from '../lib/server/Session';\r\n\r\n/**\r\n * Cleans up after the app ended with the specified code or signal.\r\n * @param {?number} exitCode The exit code received.\r\n * @param {?string} signal The signal that triggered the exit.\r\n * @param {function()} uninstall The uninstall script to run.\r\n * @return {boolean} `true` if the process should continue exiting.\r\n */\r\nexport default function cleanup(exitCode, signal, uninstall) {\r\n  uninstall();\r\n\r\n  if (signal === 'SIGINT') {\r\n    readline.clearLine(process.stdout);\r\n    readline.cursorTo(process.stdout, 0);\r\n    Logger.warn('Ctrl-C');\r\n  }\r\n\r\n  Logger.debug('Running cleanup...');\r\n\r\n  if (Session.open.length > 0) {\r\n    Logger.debug('  Closing', Session.open.length, 'open sessions...');\r\n\r\n    // Ignore further gulp error messages\r\n    Logger.removeAllListeners('error');\r\n    Logger.on('error', () => {});\r\n\r\n    Session.closeOpen()\r\n      .then(() => process.kill(process.pid, signal))\r\n      .catch((e) => {\r\n        Logger.error('Error in cleanup', e.message);\r\n        process.kill(process.pid, signal);\r\n      });\r\n\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n"],"mappings":";;;;;;AAAA,IAAAA,SAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,QAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,QAAA,GAAAH,sBAAA,CAAAC,OAAA;AAA4C,SAAAD,uBAAAI,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAE5C;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASG,OAAOA,CAACC,QAAQ,EAAEC,MAAM,EAAEC,SAAS,EAAE;EAC3DA,SAAS,CAAC,CAAC;EAEX,IAAID,MAAM,KAAK,QAAQ,EAAE;IACvBE,iBAAQ,CAACC,SAAS,CAACC,OAAO,CAACC,MAAM,CAAC;IAClCH,iBAAQ,CAACI,QAAQ,CAACF,OAAO,CAACC,MAAM,EAAE,CAAC,CAAC;IACpCE,gBAAM,CAACC,IAAI,CAAC,QAAQ,CAAC;EACvB;EAEAD,gBAAM,CAACE,KAAK,CAAC,oBAAoB,CAAC;EAElC,IAAIC,gBAAO,CAACC,IAAI,CAACC,MAAM,GAAG,CAAC,EAAE;IAC3BL,gBAAM,CAACE,KAAK,CAAC,WAAW,EAAEC,gBAAO,CAACC,IAAI,CAACC,MAAM,EAAE,kBAAkB,CAAC;;IAElE;IACAL,gBAAM,CAACM,kBAAkB,CAAC,OAAO,CAAC;IAClCN,gBAAM,CAACO,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC;IAE5BJ,gBAAO,CAACK,SAAS,CAAC,CAAC,CAChBC,IAAI,CAAC,MAAMZ,OAAO,CAACa,IAAI,CAACb,OAAO,CAACc,GAAG,EAAElB,MAAM,CAAC,CAAC,CAC7CmB,KAAK,CAAExB,CAAC,IAAK;MACZY,gBAAM,CAACa,KAAK,CAAC,kBAAkB,EAAEzB,CAAC,CAAC0B,OAAO,CAAC;MAC3CjB,OAAO,CAACa,IAAI,CAACb,OAAO,CAACc,GAAG,EAAElB,MAAM,CAAC;IACnC,CAAC,CAAC;IAEJ,OAAO,KAAK;EACd;EAEA,OAAO,IAAI;AACb","ignoreList":[]}